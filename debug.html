<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Debug Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #333; 
            border-radius: 8px;
            background: #2a2a2a;
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            background: #4CAF50; 
            color: white; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        button:hover { background: #45a049; }
        .result { 
            margin: 10px 0; 
            padding: 10px; 
            background: #333; 
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error { background: #ff4444; }
        .success { background: #4CAF50; }
    </style>
</head>
<body>
    <h1>üî• Firebase Debug Test</h1>
    
    <div class="test-section">
        <h2>1. Basic Connection Test</h2>
        <button onclick="testBasicConnection()">Test Firebase Connection</button>
        <div id="connectionResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Read Test</h2>
        <button onclick="testRead()">Test Read Scores</button>
        <div id="readResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Write Test</h2>
        <button onclick="testWrite()">Test Write Score</button>
        <div id="writeResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Create Test Data</h2>
        <button onclick="createTestData()">Create Test Leaderboard</button>
        <div id="testDataResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>5. Full Test</h2>
        <button onclick="runFullTest()">Run All Tests</button>
        <div id="fullTestResult" class="result"></div>
    </div>

    <script type="module">
        import { saveScore, getTopScores } from './leaderboard-api.js';
        import { testFirebaseConnection, createTestData as createData } from './test-data.js';
        
        // Expose functions to global scope
        window.saveScore = saveScore;
        window.getTopScores = getTopScores;
        window.testFirebaseConnection = testFirebaseConnection;
        window.createTestDataFunc = createData;
        
        window.testBasicConnection = async function() {
            const result = document.getElementById('connectionResult');
            result.textContent = 'Testing...';
            result.className = 'result';
            
            try {
                const testResult = await testFirebaseConnection();
                result.textContent = JSON.stringify(testResult, null, 2);
                result.className = testResult.success ? 'result success' : 'result error';
            } catch (error) {
                result.textContent = 'Error: ' + error.message;
                result.className = 'result error';
            }
        };
        
        window.testRead = async function() {
            const result = document.getElementById('readResult');
            result.textContent = 'Reading scores...';
            result.className = 'result';
            
            try {
                const scores = await getTopScores(10);
                result.textContent = `Found ${scores.length} scores:\n` + JSON.stringify(scores, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.textContent = 'Error: ' + error.message + '\n' + error.stack;
                result.className = 'result error';
            }
        };
        
        window.testWrite = async function() {
            const result = document.getElementById('writeResult');
            result.textContent = 'Writing test score...';
            result.className = 'result';
            
            try {
                const username = 'DebugTest_' + Date.now();
                const score = Math.floor(Math.random() * 100);
                const saveResult = await saveScore(username, score);
                
                result.textContent = `Write result:\n` + JSON.stringify(saveResult, null, 2);
                result.className = saveResult.success ? 'result success' : 'result error';
            } catch (error) {
                result.textContent = 'Error: ' + error.message + '\n' + error.stack;
                result.className = 'result error';
            }
        };
        
        window.createTestData = async function() {
            const result = document.getElementById('testDataResult');
            result.textContent = 'Creating test data...';
            result.className = 'result';
            
            try {
                const results = await createTestDataFunc();
                result.textContent = `Created ${results.length} test records:\n` + JSON.stringify(results, null, 2);
                result.className = 'result success';
            } catch (error) {
                result.textContent = 'Error: ' + error.message + '\n' + error.stack;
                result.className = 'result error';
            }
        };
        
        window.runFullTest = async function() {
            const result = document.getElementById('fullTestResult');
            result.textContent = 'Running full test suite...\n';
            result.className = 'result';
            
            try {
                // Test 1: Basic connection
                result.textContent += '1. Testing connection...\n';
                const connTest = await testFirebaseConnection();
                result.textContent += `   ${connTest.success ? '‚úÖ' : '‚ùå'} ${connTest.message}\n`;
                
                // Test 2: Read
                result.textContent += '2. Testing read...\n';
                const scores = await getTopScores(10);
                result.textContent += `   ‚úÖ Read ${scores.length} scores\n`;
                
                // Test 3: Write
                result.textContent += '3. Testing write...\n';
                const writeTest = await saveScore('FullTest_' + Date.now(), 99);
                result.textContent += `   ${writeTest.success ? '‚úÖ' : '‚ùå'} Write test\n`;
                
                // Test 4: Verify
                result.textContent += '4. Verifying...\n';
                const newScores = await getTopScores(10);
                result.textContent += `   ‚úÖ Now have ${newScores.length} scores\n`;
                
                result.textContent += '\nüéâ All tests completed!';
                result.className = 'result success';
                
            } catch (error) {
                result.textContent += '\n‚ùå Test failed: ' + error.message;
                result.className = 'result error';
            }
        };
    </script>
</body>
</html>
